# define module command and surrounding initial environment (default value
# for MODULESHOME, MODULEPATH, LOADEDMODULES and parse of init/.modulespath)
execute_process(COMMAND mktemp -t moduleinit.cmake.XXXXXXXXXXXX
  OUTPUT_VARIABLE tempfile_name)
execute_process(COMMAND @TCLSH@ @libexecdir@/modulecmd.tcl cmake autoinit
  OUTPUT_FILE ${tempfile_name})
if(EXISTS ${tempfile_name})
  include(${tempfile_name})
  file(REMOVE ${tempfile_name})
endif()
@compatversion@
@compatversion@# redefine module command if compat version has been activated
@compatversion@if("$ENV{MODULES_USE_COMPAT_VERSION}" STREQUAL "1")
@compatversion@   function(module)
@compatversion@      execute_process(COMMAND mktemp -t moduleinit.cmake.XXXXXXXXXXXX
@compatversion@         OUTPUT_VARIABLE tempfile_name)
@compatversion@      execute_process(COMMAND @libexecdir@/modulecmd-compat cmake ${ARGV}
@compatversion@         OUTPUT_FILE ${tempfile_name})
@compatversion@      if(EXISTS ${tempfile_name})
@compatversion@         include(${tempfile_name})
@compatversion@         file(REMOVE ${tempfile_name})
@compatversion@      endif()
@compatversion@   endfunction(module)
@compatversion@endif()
